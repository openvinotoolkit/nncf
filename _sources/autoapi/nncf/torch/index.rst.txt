:py:mod:`nncf.torch`
====================

.. py:module:: nncf.torch

.. autoapi-nested-parse::

   Base subpackage for NNCF PyTorch functionality.



Subpackages
-----------
.. toctree::
   :titlesonly:
   :maxdepth: 3

   knowledge_distillation/index.rst
   pruning/index.rst
   quantization/index.rst
   sparsity/index.rst


Submodules
----------
.. toctree::
   :titlesonly:
   :maxdepth: 1

   structures/index.rst




Functions
~~~~~~~~~

.. autoapisummary::

   nncf.torch.create_compressed_model
   nncf.torch.load_state
   nncf.torch.register_default_init_args
   nncf.torch.register_module
   nncf.torch.disable_tracing
   nncf.torch.no_nncf_trace
   nncf.torch.forward_nncf_trace
   nncf.torch.force_build_cpu_extensions
   nncf.torch.force_build_cuda_extensions



.. py:function:: create_compressed_model(model, config, compression_state = None, dummy_forward_fn = None, wrap_inputs_fn = None, wrap_outputs_fn = None, dump_graphs=True)

   The main function used to produce a model ready for compression fine-tuning from an original PyTorch
   model and a configuration object.

   :param model: The original model. Should have its parameters already loaded from a checkpoint or another
       source.
   :param config: A configuration object used to determine the exact compression modifications to be applied
       to the model
   :type config: nncf.NNCFConfig
   :param compression_state: representation of the entire compression state to unambiguously restore
       the compressed model. Includes builder and controller states.
   :param dummy_forward_fn: if supplied, will be used instead of a *forward* function call to build
       the internal graph representation via tracing. Specifying this is useful when the original training pipeline
       has special formats of data loader output or has additional *forward* arguments other than input tensors.
       Otherwise, the *forward* call of the model during graph tracing will be made with mock tensors according
       to the shape specified in the config object. The dummy_forward_fn code MUST contain calls to
       nncf.nncf_model_input functions made with each compressed model input tensor in the underlying model's
       args/kwargs tuple, and these calls should be exactly the same as in the wrap_inputs_fn function code
       (see below); if dummy_forward_fn is specified, then wrap_inputs_fn also must be specified.
   :param wrap_inputs_fn: if supplied, will be used on the module's input arguments during a regular, non-dummy
       forward call before passing the inputs to the underlying compressed model. This is required if the model's
       input tensors that are important for compression are not supplied as arguments to the model's forward call
       directly, but instead are located in a container (such as list), and the model receives the container as an
       argument. wrap_inputs_fn should take as input two arguments - the tuple of positional arguments to the
       underlying model's forward call, and a dict of keyword arguments to the same. The function should wrap each
       tensor among nncf.nncf_model_input function, which is a no-operation function and marks the tensors as inputs
       to be traced by NNCF in the internal graph representation. Output is the tuple of (args, kwargs), where args
       and kwargs are the same as were supplied in input, but each tensor in the original input. Must be specified
       if dummy_forward_fn is specified.
   :param wrap_outputs_fn: same as `wrap_inputs_fn`, but applies to model outputs
   :param dump_graphs: Whether to dump the internal graph representation of the
       original and compressed models in the .dot format into the log directory.
   :return: A controller for the compression algorithm (or algorithms, in which case the controller
       is an instance of CompositeCompressionController) and the model ready for compression parameter training wrapped
       as an object of NNCFNetwork.


.. py:function:: load_state(model, state_dict_to_load, is_resume = False, keys_to_ignore = None)

   Used to load a checkpoint containing a compressed model into an NNCFNetwork object, but can
   be used for any PyTorch module as well. Will do matching of state_dict_to_load parameters to
   the model's state_dict parameters while discarding irrelevant prefixes added during wrapping
   in NNCFNetwork or DataParallel/DistributedDataParallel objects, and load the matched parameters
   from the state_dict_to_load into the model's state dict.
   :param model: The target module for the state_dict_to_load to be loaded to.
   :param state_dict_to_load: A state dict containing the parameters to be loaded into the model.
   :param is_resume: Determines the behavior when the function cannot do a successful parameter match
   when loading. If True, the function will raise an exception if it cannot match the state_dict_to_load
   parameters to the model's parameters (i.e. if some parameters required by model are missing in
   state_dict_to_load, or if state_dict_to_load has parameters that could not be matched to model parameters,
   or if the shape of parameters is not matching). If False, the exception won't be raised.
   Usually is_resume is specified as False when loading uncompressed model's weights into the model with
   compression algorithms already applied, and as True when loading a compressed model's weights into the model
   with compression algorithms applied to evaluate the model.
   :param keys_to_ignore: A list of parameter names that should be skipped from matching process.
   :return: The number of state_dict_to_load entries successfully matched and loaded into model.


.. py:function:: register_default_init_args(nncf_config, train_loader, criterion = None, criterion_fn = None, train_steps_fn = None, validate_fn = None, val_loader = None, autoq_eval_fn = None, model_eval_fn = None, distributed_callbacks = None, execution_parameters = None, legr_train_optimizer = None, device = None)


.. py:function:: register_module(*quantizable_field_names, ignored_algorithms = None, target_weight_dim_for_compression = 0)


.. py:function:: disable_tracing(method)

   Patch a method so that it will be executed within no_nncf_trace context
   :param method: A method to patch.


.. py:function:: no_nncf_trace()


.. py:function:: forward_nncf_trace()


.. py:function:: force_build_cpu_extensions()


.. py:function:: force_build_cuda_extensions()


